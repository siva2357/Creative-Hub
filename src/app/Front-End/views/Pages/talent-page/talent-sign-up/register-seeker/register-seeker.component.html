<div class="container-fluid  d-flex justify-content-center align-items-center vh-100" style="background: #11131c;">

  <div class="col-md-4">

    <div *ngIf="!isLoading">

      <div class="card text-center" style="border:  1px solid rgba(0, 0, 255, 0.7); box-shadow: 0 0 10px 5px rgba(0, 149, 255, 0.7);  border-radius: 20px; -webkit-backdrop-filter: blur(15px);backdrop-filter: blur(15px); background: radial-gradient(circle, rgba(255, 255, 255, 0.274), #11131c); ">



        <div class="card-body p-5" style="border-radius: 15px;">

          <!-- Step 1: Basic User Information -->
          <div *ngIf="step === 1">
            <form [formGroup]="registrationForm">
              <!-- Full Name Input -->
              <!-- This input field allows the user to enter their full name. It has validation to ensure the field is not empty and follows a specific format -->
              <div class="form-group row align-items-center mt-3">
                <input
                  [ngClass]="{'is-invalid': registrationForm.get('fullName')?.invalid && (registrationForm.get('fullName')?.touched || registrationForm.get('fullName')?.dirty)}"
                  placeholder="Full Name" id="fullName" formControlName="fullName" type="text" class="form-control"
                  style="height: 45px; border-radius: 10px;" />
                <div *ngIf="registrationForm.get('fullName')?.touched">
                  <small *ngIf="registrationForm.get('fullName')?.errors?.['required']" class="text-danger"
                    style="font-size: 13px;">Full Name is required.</small>
                  <small *ngIf="registrationForm.get('fullName')?.errors?.['pattern']" class="text-danger">Invalid format. Must
                    start with a capital letter.</small>
                </div>
              </div>

              <!-- Username Input -->
              <!-- This input field allows the user to choose a username. It has validation to ensure the username follows the correct format -->
              <div class="form-group row align-items-center mt-3">
                <input
                  [ngClass]="{'is-invalid': registrationForm.get('userName')?.invalid && registrationForm.get('userName')?.touched}"
                  placeholder="Username" id="userName" formControlName="userName" type="text" class="form-control"
                  style="height: 45px; border-radius: 10px;" />
                <div *ngIf="registrationForm.get('userName')?.invalid && registrationForm.get('userName')?.touched">
                  <small *ngIf="registrationForm.get('userName')?.errors?.['required']" class="text-danger"
                    style="font-size: 13px;">Username is required.</small>
                  <small *ngIf="registrationForm.get('userName')?.errors?.['pattern']" class="text-danger">Invalid Username
                    format.</small>
                </div>
              </div>

              <!-- Email Input -->
              <!-- This input field allows the user to enter their email address. It has validation to ensure a valid email format -->
              <div class="form-group row align-items-center mt-3">
                <input
                  [ngClass]="{'is-invalid': registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched}"
                  placeholder="Email Address" id="email" formControlName="email" type="email" class="form-control"
                  style="height: 45px; border-radius: 10px;" />
                <div *ngIf="registrationForm.get('email')?.touched">
                  <small *ngIf="registrationForm.get('email')?.errors?.['required']" class="text-danger"
                    style="font-size: 13px;">Email is required.</small>
                  <small *ngIf="registrationForm.get('email')?.errors?.['pattern']" class="text-danger">Invalid Email
                    format.</small>
                </div>
              </div>

              <!-- Navigation Buttons -->
              <!-- These buttons allow the user to navigate to the next or previous step in the form -->
              <div class="row justify-content-between mt-3">
                <div class="col-auto">
                  <button (click)="previous()" class="btn btn-secondary" type="button">Previous</button>
                </div>
                <div class="col-auto">
                  <button (click)="next()" class="btn btn-success" [disabled]="!isStepValid()" type="button">Next</button>
                </div>
              </div>
            </form>
          </div>

          <!-- Step 2: Password and Confirmation -->
          <!-- This section allows the user to set a password and confirm it -->
          <div *ngIf="step === 2">
            <form [formGroup]="registrationForm">
              <!-- Password Input -->
              <div class="form-group row align-items-center mt-3">
                <input
                  [ngClass]="{'is-invalid': registrationForm.get('password')?.invalid && registrationForm.get('password')?.touched}"
                  placeholder="Create Password" id="password" formControlName="password" type="password" class="form-control"
                  style="height: 45px; border-radius: 10px;" />
                <div *ngIf="registrationForm.get('password')?.touched">
                  <small *ngIf="registrationForm.get('password')?.errors?.['required']" class="text-danger"
                    style="font-size: 13px;">Password is required.</small>
                  <small *ngIf="registrationForm.get('password')?.errors?.['pattern']" class="text-danger">Invalid Password
                    format.</small>
                </div>
              </div>

              <!-- Confirm Password Input -->
              <div class="form-group row align-items-center mt-3">
                <input
                  [ngClass]="{'is-invalid': registrationForm.get('confirmPassword')?.invalid && registrationForm.get('confirmPassword')?.touched}"
                  placeholder="Confirm Password" id="confirmPassword" formControlName="confirmPassword" type="password"
                  class="form-control" style="height: 45px; border-radius: 10px;" />
                <small
                  *ngIf="registrationForm.get('confirmPassword')?.touched && registrationForm.get('confirmPassword')?.hasError('required')"
                  class="text-danger" style="font-size: 13px;">Confirm Password is required.</small>
                <small *ngIf="registrationForm.hasError('mismatch') && registrationForm.get('confirmPassword')?.touched"
                  class="text-danger">Passwords do not match.</small>
              </div>

              <!-- Navigation Buttons -->
              <div class="row justify-content-between mt-3">
                <div class="col-auto">
                  <button (click)="previous()" class="btn btn-secondary" type="button">Previous</button>
                </div>
                <div class="col-auto">
                  <button (click)="next()" class="btn btn-success" [disabled]="!isStepValid()" type="button">Next</button>
                </div>
              </div>
            </form>
          </div>

          <!-- Step 3: Profile Upload -->
          <div *ngIf="step === 3">
            <form [formGroup]="registrationForm">
              <!-- Profile Upload Header -->
              <div class="container mt-3 mb-3">
                <h4 class="text-center text-white">Profile Upload</h4>
              </div>

              <!-- Profile Upload Image -->
              <!-- <div class="form-group col text-center step-container" style="display: flex; flex-direction: column; justify-content: space-between; align-items: center; height: 100%;">
                        <div class="card-profile-body rounded-4 profile-container" style="display: flex; flex-direction: column; justify-content: center; align-items: center; border: 2px solid black; width: 180px; height: 180px; overflow: hidden;">
                          <div class="profile-avatar rounded-circle" style="width: 150px; height: 150px; overflow: hidden; border: 2px solid black;">
                           <div *ngIf="ifPreview">
                            <ng-container *ngIf="fileType === 'image'">
                              <img id="avatarImage" [src]="'https://res.cloudinary.com/dpp8aspqs/image/upload/v1733121824/profie_images_opbm8k.png'" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
                              <img [src]="previewURL" class="card-img-top" id="avatarImage" style=" height: 200px;" alt="Preview Image">
                            </ng-container>
                            <i class="bi bi-x-circle-fill position-absolute text-danger" style=" right: 5px; font-size: 1.5rem; cursor: pointer;" (click)="deletePreview()"></i>
                           </div>
                           <div *ngIf="!ifPreview">
                            <img id="avatarImage" [src]="'https://res.cloudinary.com/dpp8aspqs/image/upload/v1733121824/profie_images_opbm8k.png'" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
                          </div>
                          </div>
                        </div>

                        <small class="text-muted mt-2" style="font-size: 12px; display: flex; align-items: center;">
                          <span style="margin-right: 5px;"><i class="bi bi-info-circle" style="font-size: 1rem; color: rgb(0, 110, 255);"></i></span>
                          Allowed formats: JPEG, PNG, JPG
                        </small>


                        <div class="progress w-75 mt-3 mb-5 " *ngIf="fileUploadProgress" role="progressbar" aria-label="Dynamic File Upload Progress">
                          <div class="progress-bar" [style.width.%]="fileUploadProgress | async">
                              {{ fileUploadProgress | async }}%
                          </div>
                      </div>



          <div *ngIf="uploadComplete" class="mt-3">
              <p class="text-success">Upload Completed!</p>
          </div>


                        <div class="mt-3">
                          <button type="button" class="btn btn-primary rounded-3 upload-button px-3 d-flex align-items-center" title="Upload" (click)="fileInput.click()">
                            <i class="bi bi-cloud-arrow-up upload-icon-style me-2" style="font-size: 1rem;"></i>
                            <span class="upload-text">Upload</span>
                          </button>
                          <input type="file" #fileInput id=" profilePicture" formControlName="profilePicture" class="d-none" (change)="uploadFile($event)">
                        </div>

                      </div> -->

              <!-- Profile Upload Image -->
              <div class="form-group col text-center step-container"
                style="display: flex; flex-direction: column; justify-content: space-between; align-items: center; height: 100%;">
                <div class="card-profile-body rounded-4 profile-container"
                  style="display: flex; flex-direction: column; justify-content: center; align-items: center; border: 2px solid black; width: 180px; height: 180px; overflow: hidden;">

                  <!-- Image Preview -->
                  <div *ngIf="ifPreview && fileType === 'image'">
                    <img [src]="previewURL" class="card-img-top" id="avatarImage" style="height: 200px;" alt="Preview Image">
                    <i class="bi bi-x-circle-fill position-absolute text-danger"
                      style="right: 5px; font-size: 1.5rem; cursor: pointer;" (click)="deletePreview()"></i>
                  </div>

                  <!-- Placeholder Image when no file selected -->
                  <div *ngIf="!ifPreview">
                    <img id="avatarImage"
                      [src]="previewURL||'https://res.cloudinary.com/dpp8aspqs/image/upload/v1733121824/profie_images_opbm8k.png'"
                      alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
                  </div>

                </div>

                <small class="text-muted mt-2" style="font-size: 12px; display: flex; align-items: center;">
                  <span style="margin-right: 5px;"><i class="bi bi-info-circle"
                      style="font-size: 1rem; color: rgb(0, 110, 255);"></i></span>
                  Allowed formats: JPEG, PNG, JPG
                </small>

                <!-- Upload Progress Bar -->
                <div class="progress w-75 mt-3 mb-5" *ngIf="fileUploadProgress" role="progressbar"
                  aria-label="Dynamic File Upload Progress">
                  <div class="progress-bar" [style.width.%]="fileUploadProgress | async">
                    {{ fileUploadProgress | async }}%
                  </div>
                </div>

                <!-- Success message when upload is completed -->
                <div *ngIf="uploadComplete" class="mt-3">
                  <p class="text-success">Upload Completed!</p>
                </div>

                <!-- Upload Button -->
                <div class="mt-3">
                  <button type="button" class="btn btn-primary rounded-3 upload-button px-3 d-flex align-items-center"
                    title="Upload" (click)="fileInput.click()">
                    <i class="bi bi-cloud-arrow-up upload-icon-style me-2" style="font-size: 1rem;"></i>
                    <span class="upload-text">Upload</span>
                  </button>
                  <input type="file" #fileInput id="profilePicture" formControlName="profilePicture" class="d-none"
                    (change)="uploadFile($event)">
                </div>

              </div>

            </form>

            <!-- Navigation Buttons -->
            <div class="row justify-content-between mt-3">
              <div class="col-auto">
                <button (click)="previous()" class="btn btn-secondary" type="button">Previous</button>
              </div>
              <div class="col-auto">
                <button type="submit" class="btn btn-success" [disabled]="registrationForm.invalid"
                  (click)="submit()">Submit</button>
              </div>
            </div>
          </div>

          <!-- Login Link -->
          <div class="col-12 justify-content-center mt-3">
            <p class="mb-0 text-center fs-6 text-white">Already a member? <span class="text-primary" (click)="LoginPage()"
                style="cursor: pointer;">Login</span></p>
          </div>
        </div>





        <div class="row d-flex justify-content-center align-items-center spinner-wrapper" *ngIf="isLoading">
          <div class="text-center">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <div class="mt-3">
              <!-- <p *ngIf="registrationSuccess">Redirecting you to confirmation page</p>
                      <p *ngIf="!registrationSuccess">Redirecting to signup page...</p> -->
              <p>Registering you account details</p>

            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

</div>










